#!/usr/bin/env ruby

require 'yaml'
require 'date'
require 'gmark'

files_json = Dir.glob('./**/*.json')
files_text = Dir.glob('./**/*.txt')
files_yaml = Dir.glob('./**/*.yml')

if $0 == __FILE__

  geekmarks = []
  rejectedmarks = []

  files_text.each { |mark_file|
    marks = Gmark.parse_textfile(mark_file)
    
    geekmarks = (geekmarks + marks[0]).uniq { |elem| elem.url }
    rejectedmarks = (rejectedmarks + marks[1]).uniq { |elem| elem }
  }
  
  files_json.each { |mark_file|
    marks = Gmark.parse_google(mark_file)
    
    geekmarks = (geekmarks + marks[0]).uniq { |elem| elem.url }
    rejectedmarks = (rejectedmarks + marks[1]).uniq { |elem| elem }

    geekmarks.each {|elem| puts elem.name}
  }
  
  files_yaml.each { |mark_file|
    marks = Gmark.parse_yaml(mark_file)
        
    geekmarks = (geekmarks + marks[0]).uniq { |elem| elem.url }
    rejectedmarks = (rejectedmarks + marks[1]).uniq { |elem| elem }
  }

  File.open("./gmark.yml", "w") {|f| f.write(geekmarks.to_yaml) }
  File.open("./reject.yml", "w") {|f| f.write(rejectedmarks.to_yaml) }
  
end
